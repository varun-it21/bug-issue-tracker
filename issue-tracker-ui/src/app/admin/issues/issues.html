<div class="filters">
  <input type="text" placeholder="Search title..." [(ngModel)]="searchText">

  <select [(ngModel)]="selectedStatus">
    <option value="">All Status</option>
    <option value="Open">Open</option>
    <option value="In Progress">In Progress</option>
    <option value="Completed">Completed</option>
  </select>

  <select [(ngModel)]="selectedPriority">
    <option value="">All Priority</option>
    <option value="High">High</option>
    <option value="Medium">Medium</option>
    <option value="Low">Low</option>
  </select>
  <button (click)="goToAddIssue()">Add Issue</button>
</div>


<div class="issues-container">

  <h2>All Issues</h2>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Description</th>
        <th>Priority</th>
        <th>Status</th>
        <th>Assignee</th>
        <th>Deadline</th>
        <th>Action</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let issue of paginatedIssues">
        <td>{{ issue.issueId }}</td>
        <td>{{ issue.title }}</td>
        <td>{{ issue.description }}</td>
        <td>
          <span class="badge" [ngClass]="issue.priority">{{ issue.priority }}</span>
        </td>
        <td>
          <span class="status" [ngClass]="issue.status">{{ issue.status }}</span>
        </td>
        <td>{{ userMap[issue.assignedTo] || 'Unknown' }}</td>



        <td [ngClass]="{'overdue': isOverdue(issue.deadline)}">
          {{ issue.deadline | date:'yyyy-MM-dd' }}
        </td>

        <td class="actions">
          <button (click)="openView(issue)">View</button>
          <button (click)="openEdit(issue)">Edit</button>
          <button (click)="openDelete(issue)">Delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<div class="pagination">
  <button (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
    Prev
  </button>

  <button 
    *ngFor="let page of [].constructor(totalPages); let i = index"
    (click)="changePage(i + 1)"
    [class.active]="currentPage === i + 1">
    {{ i + 1 }}
  </button>

  <button (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
    Next
  </button>
</div>

<div class="modal" *ngIf="showView">
  <div class="modal-content">
    <h3>View Issue üëÅÔ∏è</h3>

    <p><b>ID:</b> {{ selectedIssue.issueId }}</p>
    <p><b>Title:</b> {{ selectedIssue.title }}</p>
    <p><b>Description:</b> {{ selectedIssue.description }}</p>
    <p><b>Priority:</b> {{ selectedIssue.priority }}</p>
    <p><b>Status:</b> {{ selectedIssue.status }}</p>
    <p><b>Assignee:</b> {{ userMap[selectedIssue.assignedTo] }}</p>
    <p><b>Deadline:</b> {{ selectedIssue.deadline | date:'yyyy-MM-dd' }}</p>

    <!-- ‚úÖ COMMENTS SECTION -->
    <hr>
    <h4>üí¨ Comments</h4>

    <div *ngIf="comments.length === 0">
      <p>No comments yet.</p>
    </div>

    <div *ngFor="let c of comments" class="comment-box">
      <p><b>User ID:</b> {{ c.cmtBy }}</p>
      <p>{{ c.commentText }}</p>
      <small>{{ c.cmtAt | date:'short' }}</small>
      <hr>
    </div>

    <!-- ‚úÖ ADD COMMENT BOX -->
    <textarea [(ngModel)]="newComment" placeholder="Write a comment..."></textarea>
    <br>
    <button (click)="addComment()">Post Comment</button>

    <div class="modal-actions">
      <button class="btn delete" (click)="closePopup()">Close</button>
    </div>
  </div>
</div>
